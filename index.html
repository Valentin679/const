<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="styles.css">
    <script src="https://code.jquery.com/jquery-3.7.1.js"></script>
    <script src="https://code.jquery.com/ui/1.13.3/jquery-ui.js"></script>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="js/mobile-touch.js"></script>
    <script src="js/data.js"></script>
</head>
<body>
<div class="choice">
    <h3>Вы хотите собрать конфеты или шоколадный набор?</h3>
    <div>
        <button class="candiesBtn" onclick="choiceCandies()">Набор конфет</button>
        <button class="chocoBtn" onclick="choiceChoc()">Шоколадный набор</button>
    </div>
</div>
<div class="choiceBoxSize">
    <h3>Выбор коробки</h3>
    <ul class="boxSize">
        <!--            <li data-width="210" data-height="110">210x110</li>-->
        <!--            <li data-width="120" data-height="120">120x120</li>-->
        <!--            <li data-width="200" data-height="200">200x200</li>-->
    </ul>
</div>
<button class="changeBoxSizeBtn" onclick="changeBoxSize()">Изаменить размер коробки</button>
<div class="workPlace">
    <!--    <p>сделать выбор: я хочу коробку с шоколадными формами или набор конфет -> выбор коробки (размеры/количетсво конфет)->выдать выбор-->
    <!--        ассортимента относительно коробки(в конфетах наполнителя не будет)</p>-->
    <!--    <p>рассчет стоимости из объекта цен за сырье и темперирование</p>-->
    <div id="dropBox">
    </div>
    <div id="itemBox">
        <ul class="itemBoxUl">
            <!--            <li><img width="150px" src="img/otvertka.png"></li>-->
            <!--            <li><img width="150px" src="img/pila.png"></li>-->
            <!--            <li><img width="150px" src="img/pasatiji.png"></li>-->
        </ul>
    </div>
    <button class="addBtn btnAddCandies">Check</button>
</div>
</body>
<script type="application/javascript">
    //Все селекторы
    const workPlace = document.querySelector('.workPlace');
    const dropBox = document.querySelector('#dropBox');
    const itemBox = document.querySelector('#itemBox');
    const itemBoxUl = document.querySelector('.itemBoxUl');
    let addBtn = document.querySelector('.addBtn');
    const choiceBoxSize = document.querySelector('.choiceBoxSize');
    const boxSize = document.querySelector('.boxSize');

    //Получение товаров
    const getItems = (type, folder, places) => {

        // const items = candies
        // const items = forms.mens_set
        // folder = folder.substring(0, folder.indexOf('.'));
        const items = type;
        const arr = Object.entries(items);
        console.log(arr)
        let item = '';
        arr.map((form) => {
            item = item + '<li><img src="img/' + folder + form[1].src + '"/></li>';
        });
        itemBoxUl.innerHTML = item;
    }

    //Показ блока выбора размера коробки
    const changeBoxSize = () => {
        choiceBoxSize.style.display = 'block';
        document.querySelector('.changeBoxSizeBtn').style.display = 'none';
    }
    //При нажатии на кнопку выбора шоколада
    const choiceCandies = () => {
        addBtn.classList.remove("addBtn");
        choiceBoxSize.style.display = 'block';
        const boxCandies = packing.candies;
        dropBox.style.backgroundImage = 'none';//'url("' + img.src + '")';
        const arr = Object.entries(boxCandies);
        let item = '';
        arr.map((box) => {
            item = item + '<li data-type="candies" data-places="' + box[1].size.places + '" data-width="' + box[1].size.width + '" data-height="' + box[1].size.height + '" data-bg="' + box[1].src + '">' + box[1].size.width + 'x' + box[1].size.height + '<br>' + box[1].color + '</li>';
        });
        boxSize.innerHTML = item;
        document.querySelector('.choice').style.display = 'none';
        document.querySelector('.choiceBoxSize').style.display = 'block';
        addCandiesDropBox();
        // document.querySelector('.bot').style.display = 'block';
    }
    //При нажатии на кнопку выбора конфет
    const choiceChoc = () => {
        addBtn.classList.remove("btnAddCandies");
        choiceBoxSize.style.display = 'block';
        const boxChoc = packing.chocolate;
        const arr = Object.entries(boxChoc);
        let item = '';
        arr.map((box) => {
            item = item + '<li data-type="forms" data-width="' + box[1].size.width + '" data-height="' + box[1].size.height + '">' + box[1].size.width + 'x' + box[1].size.height + '<br>' + box[1].color + '</li>';
        });
        boxSize.innerHTML = item;
        document.querySelector('.choice').style.display = 'none';
        document.querySelector('.choiceBoxSize').style.display = 'block';
        addChocolatesDropBox();
    }

    //Обработчик клика на выбор размера поля
    boxSize.addEventListener('click', (event) => {
        let li = event.target;
        let width = li.dataset.width;
        let height = li.dataset.height;
        let type = li.dataset.type;
        let bgSrc = li.dataset.src;
        let places = li.dataset.places;
        console.log(places)
        dropBox.style.width = (width * 3.65) + 'px';
        dropBox.style.height = (height * 3.65) + 'px';
        dropBox.dataset.places = places;
        choiceBoxSize.style.display = 'none';
        document.querySelector('.changeBoxSizeBtn').style.display = 'block';
        workPlace.style.display = 'flex';
        // dropBox.style.backgroundImage = 'url("' + bgSrc + '")';
        if (type === "forms") {
            getItems(forms.mens_set, type);
        }
        else {
            getItems(candies, type, places);
        }
    });

    //Передвижение форм шоколада
    $(function () {
        $('.addBtn').click(function () {
            $(".draggable").draggable({containment: "#dropBox", scroll: false});
        });
    });
    //Передвижение конфет
    $(function () {
        $('.btnAddCandies').click(function () {
            $(".draggableGrid").draggable({containment: "#dropBox", grid: [110, 110], scroll: false});
        });
    });

    //Добавление шоколадов в рабочу зону
    const addChocolatesDropBox = () => {
        itemBox.addEventListener('click', (event) => {
            let parent = event.target.parentNode;
            let img = parent.querySelector('img');
            let clone = img.cloneNode(true);
            clone.classList.add('draggable');
            dropBox.append(clone)
            let addBtn = document.querySelector('.addBtn');
            addBtn.click();
        });
    }

    //Добавление конфет в рабочую зону
    const addCandiesDropBox = () => {
        let i = 0;
        itemBox.addEventListener('click', (event) => {
            let places = dropBox.dataset.places;
            let row = Math.sqrt(places)
            dropBox.style.padding = '50px';
            dropBox.style.display = "grid";
            dropBox.style.gridTemplateColumns = 'repeat(' + row + ', 110px)';
            dropBox.style.gridTemplateRows = 'repeat(' + row + ', 110px)';
            dropBox.style.gridGap = '50px';
            // #dropBox {
            //     grid-column-gap: 50px;
            //     grid-row-gap: 50px;
            // }


            let parent = event.target.parentNode;
            let img = parent.querySelector('img');
            if (i<places) {
                let clone = img.cloneNode(true);
                clone.classList.add('draggableGrid');
                dropBox.append(clone);
                i = i + 1;
            }
            else {
                alert("Места нет")
            }

            let addBtn = document.querySelector('.btnAddCandies');
            addBtn.click();
        });
    }

    // boxInner.addEventListener('click', (event) => {
    //     let img = event.target;
    //     dropBox.style.backgroundImage = 'url("' + img.src + '")';
    //     console.log(img.src)
    // });


</script>
</html>
